<!--pages/room.wxml-->
<view class="room">
  <button style="position: absolute; padding: 2px 5px; font-size: 25px; line-height: 25px; left: 4vw; top: 1vh" size="mini" bindtap="handleQuitGame">退出</button>

  <text style="position: absolute; right: 2vw; font-size: 14px; color: white; line-height: 30px; z-index: 10">剩余麻将数：{{remainMajiangNum}}</text>

  <view wx:if="{{gameStarted}}" style="position: absolute; bottom: 25vh; left: 57vw;">
    <button style="padding: 3px; z-index: 10; font-size: 25px; line-height: 25px" size="mini" bindtap="handleChi">吃</button>
    <button style="padding: 3px; z-index: 10; font-size: 25px; line-height: 25px" size="mini" bindtap="handlePeng">碰</button>
    <button style="padding: 3px; z-index: 10; font-size: 25px; line-height: 25px" size="mini" bindtap="handleGang">杠</button>
    <button style="padding: 3px; z-index: 10; font-size: 25px; line-height: 25px; margin-right: 10px" size="mini" bindtap="handleHu">胡</button>

    <button wx:if="{{ bottomUser.banker && canQiangJin && mjBottomArray.length === 16 || !bottomUser.banker && currentUserName === bottomUser.userNickName && canQiangJin}}" style="padding: 3px; z-index: 10; font-size: 25px; line-height: 25px;" size="mini" bindtap="handleQiangJin">抢金</button>
    <button wx:if="{{currentUserName === bottomUser.userNickName && currentUserName === physicalNextUserName && nextUserNameList.length === 0 && messageType > 2}}" style="padding: 3px; z-index: 10; font-size: 25px; line-height: 25px" size="mini" bindtap="handleAdd">摸</button>
    <button wx:if="{{currentUserName === bottomUser.userNickName && (currentUserName !== physicalNextUserName || nextUserNameList.length > 0) && (messageType === 3 || messageType === 12) }}" style="padding: 3px; z-index: 10; font-size: 25px; line-height: 25px" size="mini" bindtap="handlePass">过</button>
  </view>
  <image class='background' src="/assets/img/background.png" mode="aspectFill"></image>

  <view wx:if="{{showScoreboard}}" style="position: absolute; z-index: 100; width: 62vw; left: 19vw; top: 12vh; background: white; border-radius: 10px; font-size: 16px; padding: 10px 1vw">
    <view style="text-align: center; font-size: 24px; line-height: 30px">{{scoreboard.result}}</view>
    <view style="text-align: center; padding: 3px 0">
      <text style="width: 20vw; display: inline-block">用户昵称</text>
      <text style="width: 15vw; display: inline-block">上局分数</text>
      <text style="width: 15vw; display: inline-block">本局得分</text>
      <text style="width: 10vw; display: inline-block">总分</text>
    </view>
    <view wx:for="{{scoreboard.detail}}" wx:key="{{userNickName}}" style="padding: 0; text-align: center">
      <text style="width: 20vw; display: inline-block; text-overflow: ellipsis; white-space: nowrap; overflow: hidden;">{{item.userNickName}}</text>
      <text style="width: 15vw; display: inline-block">{{item.previousScore}}</text>
      <text style="width: 15vw; display: inline-block">{{item.scoreChange}}</text>
      <text style="width: 10vw; display: inline-block">{{item.score}}</text>
    </view>
    <view style="padding: 5px 0">
      <button style="width: 10vw; padding: 2px 5px; font-size: 25px; line-height: 25px;" bindtap="hideScoreBoard">确定</button>
    </view>
  </view>

  <view style="display: flex; justify-content: center;">
    <view style="margin-top: 22vh; color: white; font-size: 16px;">
      <view wx:if="{{topUser}}" class="top-user {{currentUserName === topUser.userNickName ? 'name-select': ''}}">
        <text id="top-user">{{topUser.userNickName}}{{topUser.userNickName ? '(' + topUser.score + ')' : ''}}{{topUser.banker ? '庄' : ''}}{{topUser.ready ? '(准备)' : ''}}</text>
        <view wx:if="{{dialogPosition[0].show}}" id="top-user-message" style="position: fixed; z-index: 10000; left: {{dialogPosition[0].left}}; top: {{dialogPosition[0].top}}">
          <view class="user-message">{{dialogPosition[0].message}}</view>
        </view>
      </view>

      <view wx:if="{{leftUser}}" class="left-user {{currentUserName === leftUser.userNickName ? 'name-select': ''}}">
        <text id="left-user">{{leftUser.userNickName}}{{leftUser.userNickName ? '(' + leftUser.score + ')' : ''}}{{leftUser.banker ? '庄' : ''}}{{leftUser.ready ? '(准备)' : ''}}</text>
        <view wx:if="{{dialogPosition[1].show}}" id="left-user-message" style="position: fixed; z-index: 10000; left: {{dialogPosition[1].left}}; top: {{dialogPosition[1].top}}">
          <view class="user-message">{{dialogPosition[1].message}}</view>
        </view>
      </view>

      <image src="/assets/img/desktop.png" style="width: 104px; height: 104px; position: relative; left: 14px;"></image>
      <image src="/assets/img/{{jin.code}}.png" style="width: 28px; height: 40px; position: relative; left: -55px; top: -29px; background: white; border: solid 3px orange"></image>

      <view wx:if="{{rightUser}}" class="right-user {{currentUserName === rightUser.userNickName ? 'name-select': ''}}">
        <text id="right-user">{{rightUser.userNickName}}{{rightUser.userNickName ? '(' + rightUser.score + ')' : ''}}{{rightUser.banker ? '庄' : ''}}{{rightUser.ready ? '(准备)' : ''}}</text>
        <view wx:if="{{dialogPosition[2].show}}" id="right-user-message" style="position: fixed; z-index: 10000; left: {{dialogPosition[2].left}}; top: {{dialogPosition[2].top}}">
          <view class="user-message">{{dialogPosition[2].message}}</view>
        </view>
      </view>

      <view wx:if="{{bottomUser}}" class="bottom-user {{currentUserName === bottomUser.userNickName ? 'name-select': ''}}">
        <text id="bottom-user">{{bottomUser.userNickName}}{{bottomUser.userNickName ? '(' + bottomUser.score + ')' : ''}}{{bottomUser.banker ? '庄' : ''}}{{bottomUser.ready ? '(准备)' : ''}}</text>
        <view wx:if="{{dialogPosition[3].show}}" id="bottom-user-message" style="position: fixed; z-index: 10000; left: {{dialogPosition[3].left}}; top: {{dialogPosition[3].top}}">
          <view class="user-message">{{dialogPosition[3].message}}</view>
        </view>
      </view>

      <view wx:if="{{!connected}}" style="text-align: center">
        <button style="padding: 2px 5px; font-size: 25px; line-height: 25px; margin-top: 5px; z-index: 5" size="mini" bindtap="handleReady">准备</button>
      </view>
    </view>
  </view>

  <!-- <image src="/assets/img/message.png" mode="aspectFill" bindtap="showDialog" style="z-index: 10; width: 29px; height: 25px; position: absolute; right: 1vw; bottom: 3vh; margin-right: 5px"></image> -->
  <image src="/assets/img/{{isRecording ? 'recording' : 'record'}}.png" mode="aspectFill" bindtap="showAlert" bindlongpress="startRecording" bindtouchend="stopRecording" style="z-index: 10; width: 40px; height: 40px; position: absolute; right: 1vw; bottom: 18vh;"></image>

  <scroll-view wx:if="{{showDialog}}" scroll-y class="dialog">
    <image src="/assets/img/close.png" mode="aspectFill" bindtap="closeDialog" style="z-index: 1001; width: 15px; height: 15px; position: absolute; right: 3px; top: 3px"></image>
    <view wx:for="{{dialogContentList}}" wx:key="*this" bindtap="handleSendMessage" bindto data-index="{{index}}" style="padding-left: 15px; width: 100%; border-top: solid 1px #999; line-height: 24px">
      {{item}}
    </view>
  </scroll-view>

  <view class="top">
    <view wx:for="{{mjTopArray}}" wx:key="id" style="float: left; width: 25px; position: relative">
      <image wx:if="{{item.anGang}}" src="/assets/img/mj_04.png" mode="aspectFill" style="width: 25px; height: 45px"></image>
      <image wx:if="{{!item.anGang && !item.show}}" src="/assets/img/mj_03.png" mode="aspectFill" style="width: 25px; height: 45px"></image>
      <image wx:if="{{item.show}}" src="/assets/img/mj_01.png" mode="aspectFill" style="width: 25px; height: 45px"></image>
      <image wx:if="{{item.show}}" src="/assets/img/{{item.code}}.png" mode="aspectFill" style="width: 20px; height: 28px; position: absolute; left: 2px; top: 5px; transform: rotate(180deg)"></image>
    </view>
  </view>

  <view class="left">
    <view wx:for="{{mjLeftArray}}" wx:key="id" style="width: 30px; height: 16px;  position: relative">
      <image wx:if="{{item.anGang}}" src="/assets/img/mj_18.png" mode="aspectFill" style="width: 30px; height: 20px"></image>
      <image wx:if="{{!item.anGang && !item.show}}" src="/assets/img/mj_15.png" mode="aspectFill" style="width: 20px; height: 40px"></image>
      <image wx:if="{{item.show}}" src="/assets/img/mj_16.png" mode="aspectFill" style="width: 30px; height: 20px"></image>
      <image wx:if="{{item.show}}" src="/assets/img/{{item.code}}.png" mode="aspectFill" style="width: 14px; height: 20px; position: absolute; left: 8px; top: -2px; transform: rotate(90deg);"></image>
    </view>
  </view>

  <view class="right">
    <view wx:for="{{mjRightArray}}" wx:key="id" style="width: 30px; height: 16px; position: relative">
      <image wx:if="{{item.anGang}}" src="/assets/img/mj_18.png" mode="aspectFill" style="width: 30px; height: 20px"></image>
      <image wx:if="{{!item.anGang && !item.show}}" src="/assets/img/mj_20.png" mode="aspectFill" style="width: 20px; height: 40px"></image>
      <image wx:if="{{item.show}}" src="/assets/img/mj_16.png" mode="aspectFill" style="width: 30px; height: 20px"></image>
      <image wx:if="{{item.show}}" src="/assets/img/{{item.code}}.png" mode="aspectFill" style="width: 14px; height: 20px; position: absolute; left: 8px; top: -2px; transform: rotate(270deg);"></image>
    </view>
  </view>

  <view class="bottom">
    <view style="position: relative; float: left; left: 50%; width: 593px">
      <view wx:for="{{mjBottomArray}}" wx:key="id" style="float: left; width: {{item.anGang || item.show ? '27px' : '34px'}}; position: relative; top: {{item.top}}; left: -52%; padding-top: {{ item.anGang || item.show ? '15px' : 0 }}" bindtap="handleChoose" data-index="{{index}}">
        <image wx:if="{{item.anGang}}" src="/assets/img/mj_04.png" mode="aspectFill" style="width: 27px; height: 50px"></image>

        <image wx:if="{{!item.anGang && !item.show}}" src="/assets/img/mj_02.png" mode="aspectFill" style="width: 36px; height: 66px; margin-left: {{item.id === currentInMajiangId ? '15px' : 0}}"></image>
        <image wx:if="{{!item.anGang && !item.show}}" src="/assets/img/{{item.code}}.png" mode="aspectFill" style="width: 28px; height: 40px; position: absolute; left: 4px; top: 19px; margin-left: {{item.id === currentInMajiangId ? '15px' : 0}}"></image>

        <image wx:if="{{item.show}}" src="/assets/img/mj_01.png" mode="aspectFill" style="width: 27px; height: 50px"></image>
        <image wx:if="{{item.show}}" src="/assets/img/{{item.code}}.png" mode="aspectFill" style="width: 21px; height: 30px; position: absolute; left: 3px; top: 21px"></image>
      </view>
    </view>
  </view>

  <view class="center-top">
    <view wx:for="{{mjTopOutArray}}" wx:key="id" style="float: left; width: 20px; position: relative;">
      <image src="/assets/img/mj_01.png" mode="aspectFill" style="width: 24px; height: 36px"></image>
      <image src="/assets/img/{{item.code}}.png" mode="aspectFill" style="width: 14px; height: 22px; position: absolute; left: 5px; top: 5px; transform: rotate(180deg);"></image>
      <image wx:if="{{item.isCurrent}}" src="/assets/img/diamond.png" style="width: 18px; height: 18px; position: absolute; left: 3px; top: -3px;"></image>
    </view>
  </view>

  <view class="center-left">
    <view wx:for="{{mjLeftOutArray}}" wx:key="id" style="width: 30px; height: 17px; position: relative;">
      <image src="/assets/img/mj_16.png" mode="aspectFill" style="width: 30px; height: 20px"></image>
      <image src="/assets/img/{{item.code}}.png" mode="aspectFill" style="width: 14px; height: 22px; position: absolute; left: 8px; top: -3px; transform: rotate(90deg);"></image>
      <image wx:if="{{item.isCurrent}}" src="/assets/img/diamond.png" style="width: 18px; height: 18px; position: absolute; left: 6px; top: -10px;"></image>
    </view>
  </view>

  <view class="center-right">
    <view wx:for="{{mjRightOutArray}}" wx:key="id" style="width: 30px; height: 17px; position: relative;">
      <image src="/assets/img/mj_16.png" mode="aspectFill" style="width: 30px; height: 20px"></image>
      <image src="/assets/img/{{item.code}}.png" mode="aspectFill" style="width: 14px; height: 22px; position: absolute; left: 8px; top: -3px; transform: rotate(270deg);"></image>
      <image wx:if="{{item.isCurrent}}" src="/assets/img/diamond.png" style="width: 18px; height: 18px; position: absolute; left: 6px; top: -10px;"></image>
    </view>
  </view>

  <view class="center-bottom">
    <view wx:for="{{mjBottomOutArray}}" wx:key="id" style="float: left; width: 20px; position: relative;">
      <image src="/assets/img/mj_01.png" mode="aspectFill" style="width: 24px; height: 36px"></image>
      <image src="/assets/img/{{item.code}}.png" mode="aspectFill" style="width: 14px; height: 22px; position: absolute; left: 5px; top: 5px"></image>
      <image wx:if="{{item.isCurrent}}" src="/assets/img/diamond.png" style="width: 18px; height: 18px; position: absolute; left: 3px; top: -3px;"></image>
    </view>
  </view>
</view>